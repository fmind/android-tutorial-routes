<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">

    <!-- Document meta -->
    <title>Understand and use external APIs in your Android app</title>
        <meta name="author" content="mederic.hurier@uni.lu" />
        <meta name="description" content="Introduction to Android Maps and Sign-In APIs">

    <!-- Screen adjustement -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

    <!-- Slideshow theme -->
    <link rel="stylesheet" href="revealjs/css/reveal.css">
        <link rel="stylesheet" href="revealjs/css/theme/white.css" id="theme">
    
    <!-- Code syntax highlighting -->
        <link rel="stylesheet" href="revealjs/lib/css/zenburn.css">
    
    <!-- Printing and PDF exports -->
    <script>
        var link = document.createElement( 'link' );
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = window.location.search.match( /print-pdf/gi ) ? 'revealjs/css/print/pdf.css' : 'revealjs/css/print/paper.css';
        document.getElementsByTagName( 'head' )[0].appendChild( link );
    </script>

    <!--[if lt IE 9]>
    <script src="lib/js/html5shiv.js"></script>
    <![endif]-->
</head>

<body>

<div class="reveal">

    <div class="slides">
        <section>
            <h1>Understand and use external APIs in your Android app</h1>
            <h3>mederic.hurier@uni.lu</h3>

            <p>
                <h4>2017</h4>
            </p>
        </section>  

        <section>
        <h2>Outline</h2>

        <nav id="TOC">
            <ul>
            <li><a href="#/what-is-an-api-and-its-use-case">What is an API and its use case ?</a></li>
            <li><a href="#/authenticationauthorization">Authentication/Authorization</a></li>
            <li><a href="#/how-to-google-sign-in">How-to: Google Sign-In</a></li>
            <li><a href="#/how-to-google-maps">How-to: Google Maps</a></li>
            <li><a href="#/tutorial">Tutorial</a></li>
            </ul>
        </nav>
    </section>
    
    <section><section id="what-is-an-api-and-its-use-case" class="titleslide slide level1"><h1>What is an API and its use case ?</h1></section><section id="definitions" class="slide level2">
    <h2>Definitions</h2>
    <p>API stands for <strong>A</strong>pplication <strong>P</strong>rogramming <strong>I</strong>nterface</p>
    <p>A way of communicating with a particular program.</p>
    <p>A set of rules that defines how a software program can request and receive information from another software.</p>
    <p><br />
    Source: <a href="dictionary.cambridge.org" class="uri">dictionary.cambridge.org</a></p>
    </section><section id="for-us-programmers" class="slide level2">
    <h2>For Us, Programmers</h2>
    <p><strong>A good API makes it easier to develop a program</strong></p>
    <p>Each API provides a building block for your program.</p>
    <p>The programmers then compose these building blocks.</p>
    <p>They can be used to access databases, computer hardware, GUI components (e.g. POSIX, OpenGL, SAX, PEP 249).</p>
    <p>They can also support <strong>Web Services</strong> by providing a specification for remote calls (e.g. Google, Twitter, Github).</p>
    </section><section id="where-can-we-find-apis" class="slide level2">
    <h2>Where can we find APIs ?</h2>
    <p>We can find APIs everywhere on the web.</p>
    <p>More than 14 000 APIs are available on <a href="programmableweb.com" class="uri">programmableweb.com</a></p>
    <p><a href="http://www.programmableweb.com/apis/directory" class="uri">http://www.programmableweb.com/apis/directory</a></p>
    <figure>
    <img src="img/programmableweb.png" />
    </figure>
    </section><section id="evolution" class="slide level2">
    <h2>Evolution</h2>
    <figure>
    <img src="img/api_evolutions.png" alt="Source: smartfile.com" /><figcaption>Source: smartfile.com</figcaption>
    </figure>
    </section><section id="workflow" class="slide level2">
    <h2>Workflow</h2>
    <figure>
    <img src="img/how_it_works.png" alt="Source: smartfile.com" /><figcaption>Source: smartfile.com</figcaption>
    </figure>
    </section><section id="api-oriented" class="slide level2">
    <h2>API Oriented</h2>
    <figure>
    <img src="img/api_oriented.png" alt="Source: cloud.google.com" /><figcaption>Source: cloud.google.com</figcaption>
    </figure>
    </section><section id="on-the-web" class="slide level2">
    <h2>On the web</h2>
    <figure>
    <img src="img/integration_services.png" alt="Source: developers.google.com" /><figcaption>Source: developers.google.com</figcaption>
    </figure>
    </section><section id="on-your-device" class="slide level2">
    <h2>On your device</h2>
    <figure>
    <img src="img/on_device.png" alt="Source: developers.google.com" /><figcaption>Source: developers.google.com</figcaption>
    </figure>
    </section><section id="rest-vs-soap-vs-js" class="slide level2">
    <h2>REST vs SOAP vs JS</h2>
    <figure>
    <img src="img/api_protocols.png" alt="Source: smartfile.com" /><figcaption>Source: smartfile.com</figcaption>
    </figure>
    </section><section id="rest" class="slide level2">
    <h2>REST</h2>
    <p><strong>REST for Representational State Transfer</strong></p>
    <p>It is an architectural style and an approach to lightweight communication between producers and consumers.</p>
    <figure>
    <img src="img/rest.png" />
    </figure>
    </section><section class="slide level2">
    
    <p><strong>REST has several constraints (called RESTful):</strong></p>
    <ol type="1">
    <li><p>Client-Server should be independent from each other</p></li>
    <li><p>Requests should be unrelated from each other (stateless)</p></li>
    <li><p>Cache can to store responses and save bandwidth</p></li>
    <li><p>Intermediary can be used to improve the communication in term of scalability or security (layered system)</p></li>
    <li><p>There should be an uniform interface to decouple the architecture (more information on the next slide)</p></li>
    </ol>
    </section><section class="slide level2">
    
    <p><strong>Applied to Web Services development:</strong></p>
    <ol type="1">
    <li>Each resources should have a base URI</li>
    </ol>
    <ul>
    <li>e.g. http://example.com/resources</li>
    </ul>
    <ol start="2" type="1">
    <li>The communication should rely on a media type</li>
    </ol>
    <ul>
    <li>e.g. JSON, XML, ATOM, Protocol Buffer</li>
    </ul>
    <ol start="3" type="1">
    <li>HTTP protocol and HTTP methods should be used</li>
    </ol>
    <ul>
    <li>e.g. GET, PUT, POST, DELETE</li>
    </ul>
    <ol start="4" type="1">
    <li>Links can reference states and related resources</li>
    </ol>
    </section><section class="slide level2">
    
    <figure>
    <img src="img/rest_example.png" />
    </figure>
    </section><section id="other-resources" class="slide level2">
    <h2>Other resources</h2>
    <ul>
    <li><strong>GraphQL</strong>: a query language for your API (Facebook)</li>
    </ul>
    <p><a href="http://graphql.org/" class="uri">http://graphql.org/</a></p>
    <ul>
    <li><strong>API Security Checklist</strong> (for API developers)</li>
    </ul>
    <p><a href="https://github.com/shieldfy/API-Security-Checklist" class="uri">https://github.com/shieldfy/API-Security-Checklist</a></p>
    <ul>
    <li><strong>REST Anti-Patterns</strong> (for API developers)</li>
    </ul>
    <p><a href="https://www.infoq.com/articles/rest-anti-patterns" class="uri">https://www.infoq.com/articles/rest-anti-patterns</a></p>
    </section></section>
    <section><section id="authenticationauthorization" class="titleslide slide level1"><h1>Authentication/Authorization</h1></section><section id="api-usage" class="slide level2">
    <h2>API Usage</h2>
    <p><strong>Most API services are NOT free of use</strong></p>
    <p>but free tiers are available for most providers</p>
    <p>You have to send an <strong>API Key</strong> with each request for tracking</p>
    <figure>
    <img src="img/translation.png" alt="Example: Google Translation API" /><figcaption>Example: Google Translation API</figcaption>
    </figure>
    </section><section id="oauth-2.0" class="slide level2">
    <h2>OAuth 2.0</h2>
    <p>OAuth is an open standard for authentication and authorization between multiple parties (RFC 6749).</p>
    <p>It provides a secure delegated access to <strong>server resources</strong> on behalf (e.g. user profile) of a <strong>resources owner</strong> (e.g. Google).</p>
    <figure>
    <img src="img/oauth.png" />
    </figure>
    </section><section class="slide level2">
    
    <figure>
    <img src="img/oauth_examples.png" />
    </figure>
    </section><section class="slide level2">
    
    <figure>
    <img src="img/oauth_scenario.png" alt="Source: www.digitalocean.com" /><figcaption>Source: www.digitalocean.com</figcaption>
    </figure>
    </section><section class="slide level2">
    
    <figure>
    <img src="img/oauth_authorization.png" alt="Source: www.digitalocean.com" /><figcaption>Source: www.digitalocean.com</figcaption>
    </figure>
    </section><section id="keys-and-secrets" class="slide level2">
    <h2>Keys and Secrets</h2>
    <ul>
    <li><strong>An API key</strong> identifies your application and traces its usage (between the API producer and the API consumer)</li>
    </ul>
    <figure>
    <img src="img/api_quotas.png" />
    </figure>
    <ul>
    <li><strong>An OAuth Token</strong> grants your application access to the user resources (between the API consumer and the user)</li>
    </ul>
    <figure>
    <img src="img/api_scopes.png" />
    </figure>
    </section></section>
    <section><section id="how-to-google-sign-in" class="titleslide slide level1"><h1>How-to: Google Sign-In</h1></section><section class="slide level2">
    
    <ol start="0" type="1">
    <li>Get a configuration file and move it in app/</li>
    </ol>
    <p><a href="https://developers.google.com/mobile/add?platform=android&amp;cntapi=signin" class="uri">https://developers.google.com/mobile/add?platform=android&amp;cntapi=signin</a></p>
    <figure>
    <img src="img/enable_service.png" />
    </figure>
    <p>(Behind the scene, Google creates an API key and OAuth ID)</p>
    </section><section class="slide level2">
    
    <ol type="1">
    <li>Install <strong>Google Play Service</strong> from SDK Manager</li>
    </ol>
    <figure>
    <img src="img/sdk-manager.png" />
    </figure>
    <p>(You must have Android Studio and Android SDK installed)</p>
    </section><section class="slide level2">
    
    <ol start="2" type="1">
    <li>Include this line in your project/build.gradle</li>
    </ol>
    <pre><code>    buildscript {
        ...
        dependencies {
            ...
            classpath &#39;com.google.gms:google-services:1.5.0-beta2&#39;
        }
    
    }</code></pre>
    <p><br />
    (Don't worry about the beta version ;) )</p>
    </section><section class="slide level2">
    
    <ol start="3" type="1">
    <li>And these line in your app/build.gradle</li>
    </ol>
    <pre><code>    ...
    apply plugin: &#39;com.google.gms.google-services&#39;
    
    dependencies {
        ...
        compile &#39;com.google.android.gms:play-services-auth:8.3.0&#39;
    }</code></pre>
    <p><br />
    <strong>NOTE</strong>: your device needs to have the same version !</p>
    </section><section class="slide level2">
    
    <ol start="4" type="1">
    <li>Create a new activity for your application package/SignInActivity.xml</li>
    </ol>
    <pre><code>    public class SignInActivity extends AppCompatActivity
        implements GoogleApiClient.OnConnectionFailedListener {
        private static final int RC_SIGN_IN = 9001;
        private GoogleApiClient client;
    
        @Override
        protected void onCreate(Bundle savedInstanceState) {
            ...
            GoogleSignInOptions gso = new GoogleSignInOptions
                    .Builder(GoogleSignInOptions.DEFAULT_SIGN_IN)
                    .build();
            client = new GoogleApiClient.Builder(this)
                    .enableAutoManage(this, this)
                    .addApi(Auth.GOOGLE_SIGN_IN_API, gso)
                    .build();
        }</code></pre>
    </section><section class="slide level2">
    
    <pre><code>        @Override
        public void onConnectionFailed(
            ConnectionResult connectionResult) {
    
        }
    
        @Override
        public void onClick(View v) {
            switch (v.getId()) {
                case R.id.button_sign_in:
                    signIn();
                    break;
            }
        }</code></pre>
    </section><section class="slide level2">
    
    <pre><code>        private void signIn() {
            Intent signInIntent = Auth.GoogleSignInApi
                .getSignInIntent(client);
            startActivityForResult(signInIntent, RC_SIGN_IN);
        }
    
        @Override
        public void onActivityResult(int requestCode,
                int resultCode, Intent data) {
            super.onActivityResult(requestCode, resultCode, data);
            if (requestCode == RC_SIGN_IN) {
                GoogleSignInResult result = Auth.GoogleSignInApi
                    .getSignInResultFromIntent(data);
                handleSignInResult(result);
            }
        }</code></pre>
    </section><section class="slide level2">
    
    <pre><code>    private void handleSignInResult(GoogleSignInResult result) {
            Log.i(TAG, &quot;handleSignInResult:&quot; + result.isSuccess());
    
            if (result.isSuccess()) {
                // display a message
                Toast toast = Toast.makeText(
                    getApplicationContext(),
                    &quot;Sign-in OK !&quot;, Toast.LENGTH_LONG);
                toast.show();
            }
        }</code></pre>
    </section><section class="slide level2">
    
    <ol start="5" type="1">
    <li>Add this button in your activity layout res/layout/content_sign_in.xml</li>
    </ol>
    <pre><code>&lt;com.google.android.gms.common.SignInButton
        android:id=&quot;@+id/button_sign_in&quot;
        android:layout_width=&quot;wrap_content&quot;
        android:layout_height=&quot;wrap_content&quot; /&gt;</code></pre>
    </section><section class="slide level2">
    
    <ol start="6" type="1">
    <li>Don't forget to add a Listener in package/SignInActivity.java</li>
    </ol>
    <pre><code>    protected void onCreate(Bundle savedInstanceState) {
            ...
            findViewById(R.id.button_sign_in)
                .setOnClickListener(this);
        }</code></pre>
    </section><section class="slide level2">
    
    <ol start="7" type="1">
    <li>Test your app ;)</li>
    </ol>
    <figure>
    <img src="img/demo_signin.png" />
    </figure>
    </section></section>
    <section><section id="how-to-google-maps" class="titleslide slide level1"><h1>How-to: Google Maps</h1></section><section class="slide level2">
    
    <ol type="1">
    <li>Install <strong>Google Play Service</strong> from SDK Manager</li>
    </ol>
    <figure>
    <img src="img/sdk-manager.png" />
    </figure>
    <p>(You must have Android Studio and Android SDK installed)</p>
    </section><section class="slide level2">
    
    <ol start="2" type="1">
    <li>Add the API library to your app/build.gradle</li>
    </ol>
    <pre><code>    dependencies {
        ...
        // Google Maps
        compile &#39;com.google.android.gms:play-services-maps:8.3.0&#39;
    }</code></pre>
    <p><br />
    (Android Studio should ask you to synchronize your project)</p>
    </section><section class="slide level2">
    
    <ol start="3" type="1">
    <li>Get an Android API Key and enable Google Maps API (instruction below)</li>
    </ol>
    <p><a href="https://developers.google.com/maps/documentation/android-api/signup" class="uri">https://developers.google.com/maps/documentation/android-api/signup</a></p>
    <figure>
    <img src="img/api_activation.png" />
    </figure>
    </section><section class="slide level2">
    
    <ol start="4" type="1">
    <li>Set the library version and the API key in AndroidManifest.xml</li>
    </ol>
    <pre><code>    &lt;manifest&gt;
        ...
        &lt;meta-data
          android:name=&quot;com.google.android.gms.version&quot;
          android:value=&quot;@integer/google_play_services_version&quot; /&gt;
    
        &lt;meta-data
          android:name=&quot;com.google.android.geo.API_KEY&quot;
          android:value=&quot;YOUR_API_KEY&quot; /&gt;
    &lt;/manifest&gt;</code></pre>
    <p><br />
    (The API key is a long string which start with 'AIza')</p>
    </section><section class="slide level2">
    
    <ol start="5" type="1">
    <li>(Optional) Add additional permissions in AndroidManifest.xml
    <ul>
    <li><p><strong>ACCESS_COARSE_LOCATION</strong>: allows an app to access approximate location.</p></li>
    <li><p><strong>ACCESS_FINE_LOCATION</strong>: allows an app to access precise location.</p></li>
    </ul></li>
    </ol>
    <pre><code>    &lt;manifest&gt;
        ...
        &lt;uses-permission
          android:name=&quot;android.permission.YOUR_PERMISSION&quot; /&gt;
    &lt;/manifest&gt;</code></pre>
    <p>(In Android 6.0, permissions will be asked during runtime)</p>
    </section><section class="slide level2">
    
    <ol start="6" type="1">
    <li>Create a new activity for your application: package/MapsActivity.java</li>
    </ol>
    <pre><code>    public class MapsActivity extends FragmentActivity
        implements OnMapReadyCallback {
    
        @Override
        protected void onCreate(Bundle savedInstanceState) {
            super.onCreate(savedInstanceState);
            setContentView(R.layout.activity_maps);
    
            SupportMapFragment mapFragment =
                (SupportMapFragment) getSupportFragmentManager()
                .findFragmentById(R.id.map);
    
            mapFragment.getMapAsync(this);
        }
    </code></pre>
    <p>(Remember to add an activity entry in AndroidManifest.xml)</p>
    </section><section class="slide level2">
    
    <ol start="7" type="1">
    <li>Edit the layout file as follow: res/layout/activity_maps.xml</li>
    </ol>
    <pre><code>  &lt;fragment
      xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
      xmlns:tools=&quot;http://schemas.android.com/tools&quot;
      android:layout_width=&quot;match_parent&quot;
      android:layout_height=&quot;match_parent&quot;
      android:id=&quot;@+id/map&quot;
      tools:context=&quot;.MapsActivity&quot;
      android:name=&quot;com.google.android.gms.maps.SupportMapFragment&quot;
    /&gt;</code></pre>
    </section><section class="slide level2">
    
    <pre><code>        @Override
        public void onMapReady(GoogleMap map) {
            LatLng sydney = new LatLng(-34, 151);
    
            map.addMarker(new MarkerOptions()
                .position(sydney).title(&quot;Marker in Sydney&quot;));
    
            map.moveCamera(CameraUpdateFactory.newLatLng(sydney));
        }</code></pre>
    </section><section class="slide level2">
    
    <ol start="8" type="1">
    <li>Test your app :)</li>
    </ol>
    <figure>
    <img src="img/hello_map.png" />
    </figure>
    </section></section>
    <section><section id="tutorial" class="titleslide slide level1"><h1>Tutorial</h1></section><section id="get-inspiration" class="slide level2">
    <h2>Get Inspiration</h2>
    <p>Import these projects from Google to find more examples</p>
    <p><strong>Maps</strong>: <a href="https://github.com/googlesamples/google-services" class="uri">https://github.com/googlesamples/google-services</a></p>
    <p><strong>Sign-In</strong>: <a href="https://github.com/googlemaps/android-samples" class="uri">https://github.com/googlemaps/android-samples</a></p>
    <p><br />
    (you will need to setup your own API key and Clients ID)</p>
    </section><section id="google-sign-in" class="slide level2">
    <h2>Google Sign-In</h2>
    <ul>
    <li><p>Display the user's email address once he authenticates (you need to request the permission using GoogleSignInOptions)</p></li>
    <li><p>Prevent MapsActivity from launching if the user is not login (you can use a static boolean in MainActivity)</p></li>
    <li><p>Add a disconnect button (that truly disconnect the user)</p></li>
    </ul>
    </section><section id="google-maps" class="slide level2">
    <h2>Google Maps</h2>
    <ul>
    <li><p>Center the map on Campus Kirchberg with a zoom of 15 (use Google Maps in your browser to find the coordinates and the newLatLngZoom method instead of newLatLng)</p></li>
    <li><p>Create a destination marker after a long click on a location (implements OnMapLongClickListener, there should be only 1 destination marker at a time !)</p></li>
    <li><p>Display the route, the duration and the distance between the points (have a look at <a href="https://developers.google.com/maps/documentation/directions/intro">Google Direction API</a>)</p>
    <ul>
    <li>you may want to use <a href="https://github.com/jd-alexander/Google-Directions-Android">this library</a> instead ;)</li>
    </ul></li>
    </ul>
    </section><section id="tips" class="slide level2">
    <h2>Tips</h2>
    <ul>
    <li><p>Use hardware acceleration to improve the emulator speed <a href="https://developer.android.com/tools/devices/emulator.html" class="uri">https://developer.android.com/tools/devices/emulator.html</a></p></li>
    <li><p>To zoom in/out with your mouse: double click, don't release the second click and then move your mouse up and down</p></li>
    <li><p>Remember that you can use mocks during your devs !</p></li>
    </ul>
    <p>All the APIness for your Assignment :)</p>
    </section></section>
    </div>

</div>

<script src="revealjs/lib/js/head.min.js"></script>
<script src="revealjs/js/reveal.js"></script>

<script>
    // Full list of configuration options available at:
    // https://github.com/hakimel/reveal.js#configuration
    Reveal.initialize({
        slideNumber: true,
        history: true,
        // available transition: default/cube/page/concave/zoom/linear/fade/none
                transition: Reveal.getQueryHash().transition || 'zoom',
                // Optional reveal.js plugins
        dependencies: [
            { src: 'revealjs/lib/js/classList.js', condition: function() { return !document.body.classList; } },
            { src: 'revealjs/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
            { src: 'revealjs/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
            { src: 'revealjs/plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
            { src: 'revealjs/plugin/zoom-js/zoom.js', async: true },
            { src: 'revealjs/plugin/notes/notes.js', async: true }
        ]
    });
</script>
</body>
</html>
